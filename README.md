# DO7_Docker-Compose

Проект по развертыванию микросервисов на локальной и виртуальных машинах (docker, docker compose, vagrant)

**Последовательность действий при выполнении проекта описана в ```src/REPORT.md```. Для проверки работоспособности микросервисного приложения нужен Postman**

## TASK 1

Файлы по заданию находятся в ```src/task1```.

В этой задаче нужно было развернуть микросервисное приложение. Исходный код был взят из материалов проекта. В директории ```src/task1/services``` находятся папки с каждым сервисом отдельно. В каждой из них находится Dockerfile и зависимости. Также в ```src/task1``` лежит **docker-compose.yml**

Проект запускается на локальной машине. Для запуска из папки task1 (может билдиться долго в зависимости от характеристик машины):

```bash
docker compose up --build
```

Для проверки работы используются тесты ```src/application_tests.postman_collection.json```, которые нужно импортировать в Postman и оттуда же запустить.


## TASK 2

Файлы по заданию находятся в ```src/task2```. **Для запуска нужны Vagrant и VirtualBox**

В данной задаче было произведено развертывание микросервисного приложения на виртуальной машине, созданной при помощи Vagrant. В папке находятся Vagrantfile и директория services с отдельными папками для каждого сервиса (исходный код, зависимости и Dockerfile).

Для запуска из task2:

```bash
vagrant up
```

После создания машины автоматически начнется загрузка необходимых пакетов и развертывание микросервисного приложения.

После того, как приложение забилдится, можно прогнать тесты Postman с локальной машины.


## TASK 3

Файлы по заданию находятся в ```src/task3```. 

В этой задаче нужно было создать 3 машины - manager01, worker01, worker02 при помощи Vagrant и подключить их к Docker Swarm.

Для последловательного запуска машин был написан скрипт ```vagrant_up_sh```.

Запуск машин:

```bash
./vagrant_up.sh
```

Vagrantfile запускает ```base_script.sh``` на всех машинах. Скрипт находится в ```src/task3/scripts```.

Скрипт запускает дополнительные скрипты, назначенные для разных машин в зависимости от их роли для подгрузки необходимых пакетов, открытия портов, выделения swap и подключения к Docker Swarm.

В результате выполнения у нас появляются 3 машины - один manager, управляющий развертыванием сервисов, и две worker ноды.

Работоспособность также проверяется через тесты Postman.
